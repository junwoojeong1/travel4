<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>오사카 여행</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
<!-- 사용자 업로드 웹폰트: 기본 경로는 /mnt/data/user-font.woff2 입니다. 파일명이 다르면 교체해주세요. -->
<style>
@font-face{font-family: 'UserFont'; src: url('/mnt/data/user-font.woff2') format('woff2'), url('/mnt/data/user-font.woff') format('woff'); font-weight: 700; font-style: normal; font-display: swap;}
:root{
  --bg:#f6fbff; --accent:#0077c8; --accent-2:#00a4ff; --card:#fff; --muted:#6b7881; --text:#05212b; --radius:12px; --container:1100px; --ease-ios: cubic-bezier(.2,.95,.25,1); --ease-default: cubic-bezier(.2,.9,.25,1); --swipe-duration: 420ms;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,'Noto Sans KR';-webkit-font-smoothing:antialiased;font-size:16px}
.container{max-width:var(--container);margin:12px auto;padding:0 16px}
/* Hero */
.hero{background:linear-gradient(180deg, rgba(1,37,58,0.96), rgba(0,80,140,0.85)), url('https://images.unsplash.com/photo-1505765052422-6c1f2c3c27c4?auto=format&fit=crop&w=1400&q=80'); background-size:cover;border-radius:12px;padding:18px;color:#fff;display:flex;align-items:center;gap:12px}
.hero h1{font-size:1.7rem;margin:0;line-height:1.05; font-family:'UserFont', Inter, system-ui, -apple-system}
.hero p{margin:6px 0 0 0;color:rgba(255,255,255,0.95)}
.title-font{font-family: 'UserFont', Inter, system-ui, -apple-system;}
/* Tabs */
.tabs{display:flex;gap:8px;overflow:auto;padding:8px 0;margin-top:12px;-webkit-overflow-scrolling:touch}
.tab{background:transparent;border-radius:10px;padding:8px 12px;border:1px solid rgba(5,33,43,0.06);cursor:pointer;font-weight:700;white-space:nowrap;transition:transform .18s var(--ease-default), background .25s var(--ease-default), color .18s var(--ease-default)}
.tab:active{transform:translateY(1px) scale(.99)}
.tab.active{background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#012;box-shadow:0 8px 18px rgba(1,36,70,0.12)}
/* Layout simple */
.layout{display:flex;flex-direction:column;gap:12px;margin-top:12px}
.controls{display:flex;gap:8px;align-items:center}
.controls .search{flex:1}
.places-viewport{position:relative;overflow:hidden;border-radius:12px}
.places-track{display:flex;transition:transform var(--swipe-duration) var(--ease-default);will-change:transform}
.places{display:flex;flex-direction:column;gap:10px;padding:12px;width:100%;min-height:180px}
.card{background:var(--card);border-radius:12px;padding:12px;border:1px solid rgba(5,33,43,0.06);display:flex;justify-content:space-between;align-items:center;gap:12px;transform:translateZ(0);transition:transform .28s var(--ease-default), box-shadow .28s var(--ease-default), opacity .22s var(--ease-default)}
.card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(5,33,43,0.08)}
.card.fade-out{opacity:0;transform:translateY(6px)}
.card .meta{display:flex;gap:12px;align-items:center}
.place-thumb{width:80px;height:60px;border-radius:8px;object-fit:cover;transition:transform .5s var(--ease-default)}
.small{font-size:0.86rem;color:var(--muted)}
.fab{position:fixed;right:16px;bottom:78px;width:62px;height:62px;border-radius:999px;background:linear-gradient(90deg,var(--accent-2),var(--accent));display:flex;align-items:center;justify-content:center;color:#012;font-weight:900;box-shadow:0 12px 38px rgba(3,30,50,0.18);z-index:100;transition:transform .18s var(--ease-default)}
.fab:active{transform:scale(.97)}
/* subtle pulse */
.fab::after{content:'';position:absolute;left:0;right:0;top:0;bottom:0;border-radius:999px;box-shadow:0 0 0 0 rgba(0,164,255,0.16);animation:fab-pulse 3s infinite}
@keyframes fab-pulse{0%{box-shadow:0 0 0 0 rgba(0,164,255,0.12)}50%{box-shadow:0 0 0 14px rgba(0,164,255,0.04)}100%{box-shadow:0 0 0 0 rgba(0,164,255,0.0)}}
.summary{display:flex;gap:12px;align-items:center}
.summary .pill{background:#fff;padding:8px 12px;border-radius:10px;border:1px solid rgba(5,33,43,0.06);font-weight:700;box-shadow:0 6px 20px rgba(5,33,43,0.04)}
/* Detail modal light-weight */
.modal{position:fixed;left:0;right:0;bottom:0;background:var(--card);border-top-left-radius:12px;border-top-right-radius:12px;padding:14px;border:1px solid rgba(5,33,43,0.06);box-shadow:0 -20px 40px rgba(3,30,50,0.08);transform:translateY(110%);transition:transform .32s var(--ease-default);z-index:120}
.modal.open{transform:translateY(0%)}
.modal .row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.input{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);}
.modal .actions{display:flex;gap:8px;justify-content:flex-end}
/* small devices */
@media(max-width:430px){ .hero{padding:14px;border-radius:10px} .hero h1{font-size:1.4rem} .tab{padding:8px 10px;font-size:0.95rem} .card{padding:12px} .place-thumb{width:72px;height:56px} }
</style>
</head>
<body>
  <main class="container">
    <section class="hero">
      <div>
        <h1 class="title-font">오사카 플래너 — 성인 준우의 첫 여행</h1>
        <p>탭을 손가락으로 가로 스와이프 해 날짜를 빠르게 전환하세요. iOS에 맞춘 이징과 패럴랙스가 적용되어 더 자연스럽습니다.</p>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <div class="summary">
          <div class="pill" id="totalTimeDisplay">전체: 0분</div>
          <div class="pill" id="totalPriceDisplay">예상비: 0원</div>
        </div>
      </div>
    </section>

    <!-- Tabs: 전체 + Day 1..9 -->
    <div class="tabs" id="dayTabs" role="tablist" aria-label="날짜 탭"></div>

    <div class="layout">
      <div class="controls">
        <input id="globalSearch" class="search input" placeholder="검색 (이름/타입/라벨)" />
        <button id="searchBtn" class="tab">검색</button>
        <button id="exportBtn2" class="tab">내보내기</button>
        <button id="printBtn" class="tab">인쇄</button>
      </div>

      <!-- viewport + track: 스와이프 시 track을 translateX 한다 -->
      <div class="places-viewport" id="viewport">
        <div class="places-track" id="placesTrack">
          <!-- 각 날(전체 포함)이 하나의 패널로 렌더링됩니다 -->
        </div>
      </div>
    </div>

    <!-- 간단한 하단 모달(편집) -->
    <div id="editModal" class="modal" aria-hidden="true">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong id="modalTitle">장소 편집</strong>
        <button id="closeModal">닫기</button>
      </div>
      <div class="row"><input id="m_name" class="input" placeholder="장소명"></div>
      <div class="row"><input id="m_type" class="input" placeholder="종류"></div>
      <div class="row"><input id="m_price" type="number" class="input" placeholder="예상 가격(원)"></div>
      <div class="row"><input id="m_stay" type="number" class="input" placeholder="체류시간(분)"></div>
      <div class="row"><input id="m_label" class="input" placeholder="라벨 (콤마로 구분)"></div>
      <div class="row"><input id="m_image" type="file" accept="image/*"></div>
      <div class="actions"><button id="saveModal" class="tab">저장</button><button id="deleteModal" class="tab">삭제</button></div>
    </div>

    <button id="mobileFab" class="fab">＋</button>
  </main>

<script>
// iOS detection and animation tweaks
function isIOS(){ return /iP(hone|od|ad)/.test(navigator.platform) || (navigator.userAgent.includes('Mac') && 'ontouchend' in document); }
const useEase = isIOS() ? 'var(--ease-ios)' : 'var(--ease-default)';
// Apply iOS easing to CSS variables dynamically for compatibility
if(isIOS()){ document.documentElement.style.setProperty('--ease-default', getComputedStyle(document.documentElement).getPropertyValue('--ease-ios') || 'cubic-bezier(.2,.95,.25,1)'); document.documentElement.style.setProperty('--swipe-duration','420ms'); }

const TOTAL_PANELS = 1 + 9;
let currentIndex = 0;
let isAnimating = false;

// Storage helpers with guards
function storageKey(d){ return 'osaka_day_' + d; }
for(let i=1;i<=9;i++){ try{ if(!localStorage.getItem(storageKey(i))) localStorage.setItem(storageKey(i), JSON.stringify({places:[]})); }catch(e){ console.warn('localStorage unavailable during init', e); } }
function loadDay(d){ try{ const v = localStorage.getItem(storageKey(d)); return v ? JSON.parse(v) : {places:[]}; } catch(e){ console.error('loadDay failed', e); return {places:[]}; } }
function saveDay(data,d){ try{ localStorage.setItem(storageKey(d), JSON.stringify(data)); }catch(e){ console.error('saveDay failed', e); alert('저장이 실패했습니다 — 브라우저 저장소에 문제가 있습니다.'); } }
function getAllPlaces(){ const out=[]; for(let d=1; d<=9; d++){ (loadDay(d).places||[]).forEach(p=> out.push({...p, _day:d})); } return out; }
function newPlace(){ return { id: 'p_'+Date.now(), name:'무제 장소', type:'', price:0, stayTime:0, labels:[], image:'' }; }

// UI refs
const dayTabs = document.getElementById('dayTabs');
const placesTrack = document.getElementById('placesTrack');
const viewport = document.getElementById('viewport');

const panels = [];
function buildPanels(){ placesTrack.innerHTML=''; dayTabs.innerHTML=''; panels.length=0;
  const makePanel=(label, idx)=>{
    const tab = document.createElement('button'); tab.className='tab'; tab.textContent=label; tab.dataset.index=idx; tab.addEventListener('click', ()=> switchTo(idx)); dayTabs.appendChild(tab);
    const panel = document.createElement('div'); panel.className='places'; panel.dataset.index=idx; panel.style.minWidth='100%'; panel.style.flex='0 0 100%'; panel.style.transition='opacity .28s var(--ease-default)'; placesTrack.appendChild(panel); panels.push(panel);
  };
  makePanel('전체',0);
  for(let i=1;i<=9;i++) makePanel('Day '+i, i);
  setActiveTab(); renderPanels(); updateTrackPosition(true);
}

function setActiveTab(){ Array.from(dayTabs.children).forEach(ch=> ch.classList.toggle('active', Number(ch.dataset.index) === currentIndex)); }

function renderPanels(){ const all = getAllPlaces(); panels.forEach(panel => { try{ const idx = Number(panel.dataset.index); panel.innerHTML=''; let items = (idx===0) ? all : (loadDay(idx).places||[]).map(p=>({...p,_day:idx})); const q = (document.getElementById('globalSearch').value||'').trim().toLowerCase(); if(q) items = items.filter(p=> ((p.name||'')+' '+(p.type||'')+' '+(p.labels||[]).join(' ')).toLowerCase().includes(q)); if(items.length===0){ const emp=document.createElement('div'); emp.className='card'; emp.innerHTML='<div>장소가 없습니다. + 버튼으로 추가하세요.</div>'; panel.appendChild(emp); return; } items.forEach(p=>{ const el=document.createElement('div'); el.className='card'; el.dataset.id=p.id; const left=document.createElement('div'); left.className='meta'; const img=document.createElement('img'); img.className='place-thumb'; img.loading='lazy'; img.src = p.image||'https://via.placeholder.com/160x120?text=No+Image'; img.setAttribute('data-id', p.id); left.appendChild(img); const txt=document.createElement('div'); txt.innerHTML = `<div class="title-font" style="font-weight:800">${escapeHtml(p.name||'무제 장소')}</div><div class="small">${escapeHtml(p.type||'종류 미지정')} · Day ${p._day||'?'}</div>`; left.appendChild(txt); const right=document.createElement('div'); right.style.textAlign='right'; right.innerHTML = `<div class="small">가격: ${p.price||0}원</div><div class="small">체류: ${p.stayTime||0}분</div>`; const btn=document.createElement('button'); btn.textContent='편집'; btn.className='tab'; btn.style.marginTop='8px'; btn.addEventListener('click', ()=> openEdit(p)); right.appendChild(btn); el.appendChild(left); el.appendChild(right); panel.appendChild(el); }); }catch(err){ console.error('renderPanels error', err); } }); }

function escapeHtml(s){ return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function updateTrackPosition(instant=false){ const w = Math.max(1, viewport.clientWidth); const x = - currentIndex * w; if(instant){ placesTrack.style.transition = 'none'; placesTrack.style.transform = `translateX(${x}px)`; requestAnimationFrame(()=> placesTrack.style.transition = `transform var(--swipe-duration) var(--ease-default)`); } else { placesTrack.style.transform = `translateX(${x}px)`; } setActiveTab(); }

function switchTo(index){ if(isAnimating || index===currentIndex) return; isAnimating=true; currentIndex = index; renderPanels(); updateTrackPosition(false); setTimeout(()=>{ isAnimating=false; setActiveTab(); }, parseInt(getComputedStyle(document.documentElement).getPropertyValue('--swipe-duration')) || 420); }

// Swipe + parallax
let touchStartX=0, touchCurrentX=0, touching=false;
viewport.addEventListener('touchstart', function(e){ if(e.touches && e.touches.length>1) return; touching=true; touchStartX = e.touches[0].clientX; touchCurrentX = touchStartX; placesTrack.style.transition = 'none'; }, {passive:true});
viewport.addEventListener('touchmove', function(e){ if(!touching) return; touchCurrentX = e.touches[0].clientX; const dx = touchCurrentX - touchStartX; const w = Math.max(1, viewport.clientWidth); const offset = -currentIndex * w + dx; placesTrack.style.transform = `translateX(${offset}px)`; // parallax for images: small translate opposite direction
  const imgs = placesTrack.querySelectorAll('.place-thumb'); imgs.forEach(img => { const factor = 0.12; img.style.transform = `translateX(${dx * factor}px)`; }); }, {passive:false});
viewport.addEventListener('touchend', function(e){ if(!touching) return; touching=false; const dx = touchCurrentX - touchStartX; const threshold = Math.max(40, viewport.clientWidth * 0.12); // adjust sensitivity
  // reset image transforms
  const imgs = placesTrack.querySelectorAll('.place-thumb'); imgs.forEach(img => { img.style.transform = ''; });
  if(dx > threshold && currentIndex > 0){ switchTo(currentIndex - 1); } else if(dx < -threshold && currentIndex < panels.length - 1){ switchTo(currentIndex + 1); } else { updateTrackPosition(false); } }, {passive:true});

// Desktop mouse parallax subtle
viewport.addEventListener('mousemove', function(e){ const rect = viewport.getBoundingClientRect(); const cx = e.clientX - rect.left - rect.width/2; const imgs = placesTrack.querySelectorAll('.place-thumb'); imgs.forEach((img, i)=>{ const f = 0.02; img.style.transform = `translateX(${cx * f}px)`; }); });

// Modal + editing
const modal = document.getElementById('editModal'); const m_name = document.getElementById('m_name'); const m_type = document.getElementById('m_type'); const m_price = document.getElementById('m_price'); const m_stay = document.getElementById('m_stay'); const m_label = document.getElementById('m_label'); const m_image = document.getElementById('m_image');
let editingId = null;
function openEdit(p){ editingId = p.id; modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); document.getElementById('modalTitle').textContent = (p.name||'장소 편집'); m_name.value = p.name||''; m_type.value = p.type||''; m_price.value = p.price||0; m_stay.value = p.stayTime||0; m_label.value = (p.labels||[]).join(','); }
function closeEdit(){ editingId = null; modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); }
function saveEdit(){ try{ const name = m_name.value.trim(); const type = m_type.value.trim(); const price = Number(m_price.value||0); const stay = Number(m_stay.value||0); const labels = m_label.value.split(',').map(s=>s.trim()).filter(Boolean); let found=false; for(let d=1; d<=9; d++){ const day = loadDay(d); const idx = (day.places||[]).findIndex(x=>x.id===editingId); if(idx>-1){ day.places[idx] = {...day.places[idx], name, type, price, stayTime:stay, labels}; saveDay(day,d); found=true; break; } } if(!found){ const dayIdx = currentIndex===0?1:currentIndex; const day = loadDay(dayIdx); const p = newPlace(); p.id = editingId || p.id; p.name = name; p.type = type; p.price = price; p.stayTime = stay; p.labels = labels; day.places.push(p); saveDay(day, dayIdx); } closeEdit(); renderPanels(); updateTrackPosition(); }catch(e){ console.error('saveEdit error', e); alert('저장 중 오류가 발생했습니다. 콘솔을 확인하세요.'); } }
function deleteEdit(){ if(!confirm('정말 삭제하시겠습니까?')) return; try{ for(let d=1; d<=9; d++){ const day = loadDay(d); const idx = (day.places||[]).findIndex(x=>x.id===editingId); if(idx>-1){ day.places.splice(idx,1); saveDay(day,d); break; } } closeEdit(); renderPanels(); updateTrackPosition(); }catch(e){ console.error('deleteEdit error', e); } }

m_image.addEventListener && m_image.addEventListener('change', (ev)=>{ const f = ev.target.files[0]; if(!f || !editingId) return; const r = new FileReader(); r.onload = e => { try{ for(let d=1; d<=9; d++){ const day = loadDay(d); const idx = (day.places||[]).findIndex(x=>x.id===editingId); if(idx>-1){ day.places[idx].image = e.target.result; saveDay(day,d); break; } } renderPanels(); }catch(err){ console.error('image save error', err); } }; r.readAsDataURL(f); });

// FAB create + open edit
const fab = document.getElementById('mobileFab'); fab.addEventListener('click', ()=>{ try{ const dayIdx = currentIndex===0?1:currentIndex; const day = loadDay(dayIdx); const p = newPlace(); day.places.push(p); saveDay(day, dayIdx); renderPanels(); updateTrackPosition(); setTimeout(()=> openEdit(p), 220); }catch(e){ console.error('fab add error', e); } });

// controls
document.getElementById('searchBtn').addEventListener('click', ()=> renderPanels());
document.getElementById('exportBtn2').addEventListener('click', ()=>{ try{ const dump={}; for(let d=1; d<=9; d++) dump['Day'+d] = loadDay(d); const blob = new Blob([JSON.stringify(dump,null,2)], {type:'application/json'}); const a=document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'osaka_export.json'; a.click(); URL.revokeObjectURL(a.href); }catch(e){ console.error('export error', e); alert('내보내기 실패'); } });
document.getElementById('printBtn').addEventListener('click', ()=>{ try{ const w = window.open('','_blank'); let html = '<!doctype html><html><head><meta charset="utf-8"><title>Print</title></head><body style="font-family:Inter,system-ui;">'; for(let d=1; d<=9; d++){ const day = loadDay(d); if(!day.places || !day.places.length) continue; html += `<h2>Day ${d}</h2>`; day.places.forEach(p => { html += `<div><strong>${escapeHtml(p.name)}</strong> — ${escapeHtml(p.type)} — ${p.price}원 — ${p.stayTime}분</div>`; }); } html += '</body></html>'; w.document.write(html); w.document.close(); setTimeout(()=> w.print(), 400); }catch(e){ console.error('print error', e); alert('인쇄 중 오류가 발생했습니다.'); } });

// build and render initial
buildPanels();

// global error listener to capture unexpected exceptions
window.addEventListener('error', function(ev){ console.error('Global error captured', ev.error || ev.message); });

// accessibility: keyboard navigation
window.addEventListener('keydown', (e)=>{ if(e.key === 'ArrowLeft'){ if(currentIndex > 0) switchTo(currentIndex-1); } else if(e.key === 'ArrowRight'){ if(currentIndex < panels.length-1) switchTo(currentIndex+1); } });

// recalc track on resize
window.addEventListener('resize', ()=> updateTrackPosition(true));
</script>
</body>
</html>
